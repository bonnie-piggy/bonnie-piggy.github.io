
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>增强版随机气泡互动</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e2e8f0;
            min-height: 100vh;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            text-align: center;
        }
        
        header {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(15, 23, 42, 0.7);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 1rem;
            background: linear-gradient(90deg, #4fd1c5, #38b2ac, #81e6d9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(76, 209, 197, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #a0aec0;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .stats-container {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }
        
        .stat-box {
            background: rgba(15, 23, 42, 0.8);
            padding: 1.2rem;
            border-radius: 10px;
            min-width: 180px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .stat-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #4fd1c5;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #a0aec0;
        }
        
        .bubble-container {
            position: relative;
            width: 100%;
            height: 500px;
            margin: 2rem 0;
            background: rgba(15, 23, 42, 0.3);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
        }
        
        button {
            padding: 0.8rem 1.5rem;
            background: rgba(56, 178, 172, 0.2);
            color: #4fd1c5;
            border: 1px solid #38b2ac;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        button:hover {
            background: rgba(56, 178, 172, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 209, 197, 0.3);
        }
        
        .instructions {
            background: rgba(15, 23, 42, 0.8);
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 800px;
        }
        
        .instructions h2 {
            color: #4fd1c5;
            margin-bottom: 1rem;
        }
        
        .instructions p {
            line-height: 1.6;
            color: #cbd5e0;
            margin-bottom: 0.5rem;
        }
        
        /* 气泡样式 */
        .bubble {
            position: absolute;
            border-radius: 50%;
            cursor: pointer;
            transition: opacity 0.5s ease, transform 0.5s ease;
            box-shadow: 
                inset 0 0 20px rgba(255, 255, 255, 0.2),
                0 0 20px rgba(79, 209, 197, 0.3),
                0 0 30px rgba(79, 209, 197, 0.2);
        }
        
        /* 增强浮动动画幅度 */
        @keyframes float {
            0%, 100% {
                transform: translateY(0) translateX(0);
            }
            20% {
                transform: translateY(-60px) translateX(40px);
            }
            40% {
                transform: translateY(-120px) translateX(-30px);
            }
            60% {
                transform: translateY(-90px) translateX(50px);
            }
            80% {
                transform: translateY(-30px) translateX(-40px);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 
                    inset 0 0 20px rgba(255, 255, 255, 0.2),
                    0 0 20px rgba(79, 209, 197, 0.3),
                    0 0 30px rgba(79, 209, 197, 0.2);
            }
            50% {
                transform: scale(1.1);
                box-shadow: 
                    inset 0 0 30px rgba(255, 255, 255, 0.3),
                    0 0 30px rgba(79, 209, 197, 0.5),
                    0 0 40px rgba(79, 209, 197, 0.4);
            }
        }
        
        .status-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            background: rgba(220, 38, 38, 0.9);
            color: white;
            border-radius: 8px;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: opacity 0.5s, transform 0.5s;
        }
        
        .status-alert.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .status-alert.warning {
            background: rgba(234, 179, 8, 0.9);
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .stats-container {
                gap: 1rem;
            }
            
            .stat-box {
                min-width: 140px;
            }
            
            .bubble-container {
                height: 400px;
            }
            
            .status-alert {
                top: 10px;
                right: 10px;
                left: 10px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>增强版随机气泡互动</h1>
            <p class="subtitle">气泡浮动幅度增强！当气泡少于2个或大于20个时将自动重置</p>
            
            <div class="stats-container">
                <div class="stat-box">
                    <div class="stat-value" id="total-bubbles">0</div>
                    <div class="stat-label">生成气泡总数</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="current-bubbles">0</div>
                    <div class="stat-label">当前气泡数量</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="popped-bubbles">0</div>
                    <div class="stat-label">消失气泡计数</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="click-count">0</div>
                    <div class="stat-label">点击次数</div>
                </div>
            </div>
        </header>
        
        <div class="bubble-container" id="bubble-container">
            <!-- 气泡将在这里生成 -->
        </div>
        
        <div class="controls">
            <button id="add-bubbles">添加气泡</button>
            <button id="reset-btn">手动重置</button>
        </div>
        
        <div class="instructions">
            <h2>游戏说明</h2>
            <p>• 每次点击"添加气泡"按钮会生成1-10个随机气泡</p>
            <p>• 气泡会大幅浮动并改变透明度</p>
            <p>• 点击气泡时：有50%几率气泡会消失，50%几率气泡会变得几乎透明</p>
            <p>• 消失的气泡会被计数</p>
            <p>• <strong>自动重置：当气泡少于2个或大于20个时将自动重置</strong></p>
        </div>
    </div>
    
    <div class="status-alert" id="status-alert">自动重置已触发！</div>

    <script>
        // 配置变量
        const CONFIG = {
            // 气泡大小范围
            minSize: 40,
            maxSize: 90,
            // 气泡颜色
            colors: [
                'rgba(79, 209, 197, 0.7)',   // 青色
                'rgba(56, 178, 172, 0.7)',   // 蓝绿色
                'rgba(49, 151, 149, 0.7)',   // 深蓝绿色
                'rgba(129, 230, 217, 0.7)',  // 浅青色
                'rgba(102, 217, 232, 0.7)',  // 天蓝色
                'rgba(116, 250, 213, 0.7)'   // 薄荷绿
            ],
            // 气泡浮动速度范围（速度更快）
            minFloatSpeed: 10,
            maxFloatSpeed: 25,
            // 气泡透明度变化范围
            minOpacity: 0.3,
            maxOpacity: 0.9,
            // 气泡透明度变化速度
            opacityChangeSpeed: 0.005,
            // 自动重置阈值
            minBubblesThreshold: 2,
            maxBubblesThreshold: 20,
            // 初始气泡数量
            initialBubbleCount: 5
        };
        
        // 状态变量
        let state = {
            totalBubbles: 0,
            currentBubbles: 0,
            poppedBubbles: 0,
            clickCount: 0,
            bubbleElements: [],
            autoResetEnabled: true,
            resetInProgress: false
        };
        
        // DOM 元素
        const bubbleContainer = document.getElementById('bubble-container');
        const totalBubblesEl = document.getElementById('total-bubbles');
        const currentBubblesEl = document.getElementById('current-bubbles');
        const poppedBubblesEl = document.getElementById('popped-bubbles');
        const clickCountEl = document.getElementById('click-count');
        const addBubblesBtn = document.getElementById('add-bubbles');
        const resetBtn = document.getElementById('reset-btn');
        const statusAlert = document.getElementById('status-alert');
        
        // 初始化
        function init() {
            // 添加初始气泡
            addBubbles(CONFIG.initialBubbleCount);
            
            // 事件监听器
            addBubblesBtn.addEventListener('click', () => {
                const bubbleCount = Math.floor(Math.random() * 10) + 1;
                addBubbles(bubbleCount);
                // 添加后检查是否超过阈值
                checkAndAutoReset();
            });
            
            resetBtn.addEventListener('click', manualReset);
            
            // 开始气泡动画循环
            requestAnimationFrame(animateBubbles);
            
            // 添加键盘快捷键
            document.addEventListener('keydown', (e) => {
                if (e.key === 'a' || e.key === 'A') {
                    addBubbles(Math.floor(Math.random() * 10) + 1);
                } else if (e.key === 'r' || e.key === 'R') {
                    manualReset();
                } else if (e.key === 't' || e.key === 'T') {
                    state.autoResetEnabled = !state.autoResetEnabled;
                    showAlert(`自动重置已${state.autoResetEnabled ? '启用' : '禁用'}`, state.autoResetEnabled ? 'warning' : '');
                }
            });
        }
        
        // 添加指定数量的气泡
        function addBubbles(count) {
            for (let i = 0; i < count; i++) {
                createBubble();
            }
            
            // 更新统计
            updateStats();
        }
        
        // 创建单个气泡
        function createBubble() {
            // 创建气泡元素
            const bubble = document.createElement('div');
            bubble.className = 'bubble';
            
            // 随机大小
            const size = Math.floor(Math.random() * (CONFIG.maxSize - CONFIG.minSize)) + CONFIG.minSize;
            
            // 随机位置（确保气泡完全在容器内）
            const containerWidth = bubbleContainer.clientWidth;
            const containerHeight = bubbleContainer.clientHeight;
            const left = Math.random() * (containerWidth - size * 2) + size;
            const top = Math.random() * (containerHeight - size * 2) + size;
            
            // 随机颜色
            const color = CONFIG.colors[Math.floor(Math.random() * CONFIG.colors.length)];
            
            // 设置气泡样式
            bubble.style.width = `${size}px`;
            bubble.style.height = `${size}px`;
            bubble.style.left = `${left}px`;
            bubble.style.top = `${top}px`;
            bubble.style.background = color;
            
            // 随机浮动速度
            const floatSpeed = Math.random() * (CONFIG.maxFloatSpeed - CONFIG.minFloatSpeed) + CONFIG.minFloatSpeed;
            const pulseSpeed = floatSpeed * 2;
            
            // 初始透明度
            const initialOpacity = Math.random() * (CONFIG.maxOpacity - CONFIG.minOpacity) + CONFIG.minOpacity;
            bubble.style.opacity = initialOpacity;
            
            // 添加增强浮动动画
            bubble.style.animation = `float ${floatSpeed}s infinite ease-in-out, pulse ${pulseSpeed}s infinite ease-in-out`;
            
            // 添加点击事件
            bubble.addEventListener('click', handleBubbleClick);
            
            // 添加到容器和状态
            bubbleContainer.appendChild(bubble);
            state.bubbleElements.push({
                element: bubble,
                opacityDirection: Math.random() > 0.5 ? 1 : -1, // 1表示增加，-1表示减少
                currentOpacity: initialOpacity,
                floatSpeed: floatSpeed,
                originalX: left,
                originalY: top,
                floatOffsetX: 0,
                floatOffsetY: 0,
                floatTime: 0
            });
            
            // 更新计数
            state.totalBubbles++;
            state.currentBubbles++;
        }
        
        // 处理气泡点击
        function handleBubbleClick(event) {
            const bubble = event.target;
            state.clickCount++;
            
            // 50%几率气泡消失，50%几率气泡变得几乎透明
            if (Math.random() > 0.5) {
                // 气泡消失
                bubble.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                bubble.style.opacity = '0';
                bubble.style.transform = 'scale(0)';
                
                // 从状态中移除
                setTimeout(() => {
                    if (bubble.parentNode) {
                        bubble.parentNode.removeChild(bubble);
                        state.currentBubbles--;
                        state.poppedBubbles++;
                        updateStats();
                        
                        // 从状态数组中移除
                        state.bubbleElements = state.bubbleElements.filter(b => b.element !== bubble);
                        
                        // 检查是否需要自动重置
                        checkAndAutoReset();
                    }
                }, 300);
            } else {
                // 气泡变得几乎透明
                bubble.style.transition = 'opacity 0.2s ease';
                bubble.style.opacity = '0.1';
                
                // 更新状态中的当前透明度
                const bubbleState = state.bubbleElements.find(b => b.element === bubble);
                if (bubbleState) {
                    bubbleState.currentOpacity = 0.1;
                }
            }
            
            // 更新统计
            updateStats();
        }
        
        // 气泡动画循环
        function animateBubbles() {
            state.bubbleElements.forEach(bubbleState => {
                const bubble = bubbleState.element;
                
                // 更新浮动时间
                bubbleState.floatTime += 0.02;
                
                // 计算浮动偏移量（增强幅度）
                const floatX = Math.sin(bubbleState.floatTime) * 80 + 
                              Math.cos(bubbleState.floatTime * 0.7) * 40;
                const floatY = Math.cos(bubbleState.floatTime * 0.9) * 120 + 
                              Math.sin(bubbleState.floatTime * 1.3) * 60;
                
                // 应用浮动位置
                bubble.style.transform = `translate(${floatX}px, ${floatY}px)`;
                
                // 更新透明度
                if (parseFloat(bubble.style.opacity) > 0.1) {
                    bubbleState.currentOpacity += CONFIG.opacityChangeSpeed * bubbleState.opacityDirection;
                    
                    // 检查边界
                    if (bubbleState.currentOpacity >= CONFIG.maxOpacity) {
                        bubbleState.currentOpacity = CONFIG.maxOpacity;
                        bubbleState.opacityDirection = -1; // 开始减少
                    } else if (bubbleState.currentOpacity <= CONFIG.minOpacity) {
                        bubbleState.currentOpacity = CONFIG.minOpacity;
                        bubbleState.opacityDirection = 1; // 开始增加
                    }
                    
                    // 应用透明度
                    bubble.style.opacity = bubbleState.currentOpacity;
                }
            });
            
            // 继续动画循环
            requestAnimationFrame(animateBubbles);
        }
        
        // 检查并自动重置
        function checkAndAutoReset() {
            if (!state.autoResetEnabled || state.resetInProgress) return;
            
            // 检查气泡数量是否超出阈值
            if (state.currentBubbles < CONFIG.minBubblesThreshold || 
                state.currentBubbles > CONFIG.maxBubblesThreshold) {
                
                state.resetInProgress = true;
                
                // 显示提示
                let reason = '';
                if (state.currentBubbles < CONFIG.minBubblesThreshold) {
                    reason = `气泡太少（${state.currentBubbles} < ${CONFIG.minBubblesThreshold}）`;
                } else {
                    reason = `气泡太多（${state.currentBubbles} > ${CONFIG.maxBubblesThreshold}）`;
                }
                showAlert(`自动重置：${reason}`);
                
                // 延迟执行重置，让用户看到提示
                setTimeout(() => {
                    autoReset();
                    state.resetInProgress = false;
                }, 1500);
            }
        }
        
        // 自动重置
        function autoReset() {
            // 移除所有气泡
            removeAllBubbles();
            
            // 重置状态（但保留总统计）
            state.currentBubbles = 0;
            state.bubbleElements = [];
            
            // 添加初始气泡
            const resetCount = Math.floor((CONFIG.minBubblesThreshold + CONFIG.maxBubblesThreshold) / 2);
            addBubbles(resetCount);
        }
        
        // 手动重置
        function manualReset() {
            showAlert("手动重置已触发！", "warning");
            
            // 移除所有气泡
            removeAllBubbles();
            
            // 重置状态
            state.totalBubbles = 0;
            state.currentBubbles = 0;
            state.poppedBubbles = 0;
            state.clickCount = 0;
            state.bubbleElements = [];
            
            // 更新统计
            updateStats();
            
            // 添加初始气泡
            addBubbles(CONFIG.initialBubbleCount);
        }
        
        // 移除所有气泡
        function removeAllBubbles() {
            // 为所有气泡添加消失动画
            state.bubbleElements.forEach(bubbleState => {
                const bubble = bubbleState.element;
                bubble.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                bubble.style.opacity = '0';
                bubble.style.transform = 'scale(0)';
            });
            
            // 延迟后移除所有气泡
            setTimeout(() => {
                while (bubbleContainer.firstChild) {
                    bubbleContainer.removeChild(bubbleContainer.firstChild);
                }
            }, 500);
        }
        
        // 更新统计显示
        function updateStats() {
            totalBubblesEl.textContent = state.totalBubbles;
            currentBubblesEl.textContent = state.currentBubbles;
            
            // 如果当前气泡数量超出阈值，高亮显示
            if (state.currentBubbles < CONFIG.minBubblesThreshold || 
                state.currentBubbles > CONFIG.maxBubblesThreshold) {
                currentBubblesEl.style.color = '#f87171'; // 红色
            } else {
                currentBubblesEl.style.color = '#4fd1c5'; // 青色
            }
            
            poppedBubblesEl.textContent = state.poppedBubbles;
            clickCountEl.textContent = state.clickCount;
        }
        
        // 显示提示
        function showAlert(message, type = '') {
            statusAlert.textContent = message;
            statusAlert.className = 'status-alert show';
            
            if (type) {
                statusAlert.classList.add(type);
            } else {
                statusAlert.classList.remove('warning');
            }
            
            // 3秒后隐藏
            setTimeout(() => {
                statusAlert.classList.remove('show');
            }, 3000);
        }
        
        // 页面加载完成后初始化
        window.addEventListener('load', init);
    </script>
</body>
</html>